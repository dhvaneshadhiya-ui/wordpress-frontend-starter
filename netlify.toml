# Netlify configuration for OG image generation and Image CDN

# Enable Image CDN for remote WordPress images
[images]
  remote_images = ["https://dev.igeeksblog.com/.*"]

[[edge_functions]]
  function = "og"
  path = "/og"

[[headers]]
  for = "/og"
  [headers.values]
    Cache-Control = "public, s-maxage=31536000, immutable"

# Block indexing via HTTP header (staging site)
[[headers]]
  for = "/*"
  [headers.values]
    X-Robots-Tag = "noindex, nofollow"

# Build settings - Full SSG pipeline for Netlify
# Lovable uses simple "vite build" automatically
[build]
  command = "vite build && vite build --ssr src/entry-server.tsx --outDir dist/server && node prerender.js && node scripts/generate-robots.js && node scripts/generate-sitemap.js"
  publish = "dist"

# Rewrite clean URLs to flat .html files (before SPA fallback)
# Post slugs at root: /my-post -> /my-post.html
[[redirects]]
  from = "/:slug"
  to = "/:slug.html"
  status = 200
  force = false

# Category archives: /category/tech -> /category/tech.html
[[redirects]]
  from = "/category/:slug"
  to = "/category/:slug.html"
  status = 200
  force = false

# Tag archives: /tag/iphone -> /tag/iphone.html
[[redirects]]
  from = "/tag/:slug"
  to = "/tag/:slug.html"
  status = 200
  force = false

# Author archives: /author/john -> /author/john.html
[[redirects]]
  from = "/author/:slug"
  to = "/author/:slug.html"
  status = 200
  force = false

# SPA fallback - serve index.html for any unmatched routes
# This allows React Router to handle dynamic routes client-side
# when SSG files are not available
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false
