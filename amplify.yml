version: 1

frontend:
  phases:
    preBuild:
      commands:
        - echo "=== PREBUILD START ==="
        - node --version
        - npm --version
        - npm install
        - echo "=== PREBUILD COMPLETE ==="
    build:
      commands:
        - echo "=== BUILD START ==="
        - export VITE_WORDPRESS_API_URL=https://dev.igeeksblog.com/wp-json/wp/v2
        - export SITE_URL=https://dev.igeeksblog.com
        
        - echo "--- Step 1: Fetch WordPress content ---"
        - node scripts/fetch-wp-content.js
        - ls -la src/data/
        
        - echo "--- Step 2: Vite build ---"
        - npx vite build
        - ls -la dist/
        
        - echo "--- Step 3: Generate static HTML ---"
        - node scripts/build-static.js
        
        - echo "--- Step 4: Generate SEO files ---"
        - node scripts/generate-seo-files.js
        
        - echo "=== BUILD COMPLETE ==="
        - find dist -name "*.html" | wc -l
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
