version: 1

frontend:
  phases:
    preBuild:
      commands:
        - nvm install 18
        - nvm use 18
        - node --version
        - npm install
    build:
      commands:
        - export VITE_WORDPRESS_API_URL=https://dev.igeeksblog.com/wp-json/wp/v2
        - export SITE_URL=https://dev.igeeksblog.com
        
        - echo "=== Step 1: Fetching WordPress content ==="
        - nvm use 18 && node scripts/fetch-wp-content.js
        - test -f src/data/posts.json && echo "✅ posts.json exists" || exit 1
        
        - echo "=== Step 2: Building Vite application ==="
        - nvm use 18 && npx vite build
        - test -f dist/index.html && echo "✅ dist/index.html exists" || exit 1
        
        - echo "=== Step 3: Generating static HTML with SEO ==="
        - nvm use 18 && node scripts/build-static.js
        
        - echo "=== Step 4: Generating sitemaps and robots.txt ==="
        - nvm use 18 && node scripts/generate-seo-files.js
        
        - echo "=== Build complete ==="
        - find dist -name "index.html" | wc -l
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
