version: 1

frontend:
  phases:
    preBuild:
      commands:
        - npm install
        - echo "Setting environment variables..."
        - export VITE_WORDPRESS_API_URL=https://dev.igeeksblog.com/wp-json/wp/v2
        - echo "Fetching WordPress content for static generation..."
        - node scripts/fetch-wp-content.js
    build:
      commands:
        - echo "Generating static HTML pages..."
        - node scripts/build-static.js
        - echo "Building Vite application..."
        - npm run build
        - echo "Copying static pages to dist..."
        - cp -r static/* dist/ 2>/dev/null || true
    postBuild:
      commands:
        - echo "Generating sitemaps and robots.txt..."
        - node scripts/generate-seo-files.js
        - echo "Build complete!"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - src/data/**/*

# Environment variables are now set inline in preBuild commands
# You can also set them in AWS Amplify Console for security
