version: 1

frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - echo "=== Setting environment variables ==="
        - export VITE_WORDPRESS_API_URL=https://dev.igeeksblog.com/wp-json/wp/v2
        - export SITE_URL=https://dev.igeeksblog.com
        - echo "VITE_WORDPRESS_API_URL=$VITE_WORDPRESS_API_URL"
        - echo "SITE_URL=$SITE_URL"
        - echo ""
        - echo "=== Step 1: Fetching WordPress content ==="
        - node scripts/fetch-wp-content.js
        - echo ""
        - echo "=== Step 2: Building Vite application ==="
        - npx vite build
        - echo ""
        - echo "=== Step 3: Generating static HTML with SEO ==="
        - node scripts/build-static.js
        - echo ""
        - echo "=== Step 4: Generating sitemaps and robots.txt ==="
        - node scripts/generate-seo-files.js
        - echo ""
        - echo "=== Build complete! Listing dist contents ==="
        - ls -la dist/
        - ls -la dist/assets/ 2>/dev/null || echo "No assets directory found"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*

# Build order: fetch content -> vite build -> generate static HTML -> SEO files
# Static HTML is generated directly into dist/ after Vite build
